"use strict";function initDatePicker(){$(".date-picker").datepicker({format:"yyyy-mm-dd",language:"ru",todayHighlight:!0,startDate:"1999-01-01",endDate:"+1m"}).on("changeDate",function(t){$(".input-date-field input").val(t.date)})}function setDate(){var t=$(".input-date-field input").val();$(".date-picker").datepicker("setDate",t)}function initSelect(){$("select.select2it").each(function(){$(this).next(".select2-container").remove(),$(this).select2({theme:"bootstrap",tags:!0,allowClear:!0,placeholder:"Не задано",width:"100%"})})}$(function(){$("form a.submit-form, form input.delete-button, form.remote button").on("click",function(t){t.preventDefault();var e=$(this).parents("form"),n=e.find(".confirm-message");return 0<n.length&&!confirm(n.val())||e.submit(),!1})}),$(function(){initDatePicker()}),$(window).on("turbolinks:load",function(){initDatePicker(),setDate()}),$(function(){initSelect()}),$(window).on("turbolinks:load",function(){initSelect()});var _cropperjs=_interopRequireDefault(require("cropperjs"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('img[data-toggle="cropp"]').forEach(function(t){var o=document.querySelector('input[name*="'+t.dataset.coord+'"]'),e=t.dataset.preview,n=t.dataset.aspectRatio;new _cropperjs.default(t,{aspectRatio:n,preview:e,maxContainerWidth:"200px",crop:function(t){var e=Math.round(t.detail.width),n=Math.round(t.detail.height),a=Math.round(t.detail.x),i=Math.round(t.detail.y);o.value=e+"x"+n+"+"+a+"+"+i}})})});var spinnerOpts={lines:11,length:5,width:2,radius:5,corners:1,rotate:0,color:"#fff",speed:1,trail:50,shadow:!1,hwaccel:!1,className:"spinner",zIndex:1e3,top:"auto",left:"auto"};$(function(){var e=this,t=null!=navigator.userAgent.match(/(iPhone|iPod|iPad|BlackBerry|Android|Windows Phone|Opera Mobi)/i),n="ontouchstart"in window||navigator.msMaxTouchPoints;$(document).bind("ajaxStart turbolinks:request-start uploadStart",function(){$("#activity").show().spin(spinnerOpts)}).bind("ajaxStop turbolinks:request-end uploadStop",function(){$("#activity").hide().spin(!1)}),$(document).on("click",".js-sidebar-toggle",function(t){t.preventDefault(),$(".page").toggleClass("sidebar-opened")}),$(document).on("click",".js-nav-group-toggle",function(t){t.preventDefault(),$(this).parent().toggleClass("opened")}),$(document).on("click",".nav__link",function(){$(".nav__item").removeClass("active"),$(this).closest(".nav__item").addClass("active")}),$(document).on("click",".nav__link",function(){var t=$(this).closest(".nav__group");$(".nav__group").not(t).removeClass("opened")}),$(document).on("change",".uploader__check input",function(){var t=$(this).closest(".uploader__item");$(this).is(":checked")?t.addClass("chosen"):t.removeClass("chosen")}),$(document).on("change",".js-file input",function(t){t.preventDefault();var e=this.value,n=this.nextElementSibling;e=e.replace(/.*[/\\]/,""),n.textContent=e}),$(document).on("click",".nav-tabs .nav-link, .nav-pills .nav-link",function(t){t.preventDefault(),$(this).tab("show")}),$(document).ready(function(){var t=$(".sidebar__header-content"),e=t.height();t.css("margin-top",-e)}),$(window).on("load turbolinks:load",function(){$(".sidebar").find(".nav__group .nav__item.active").each(function(){var t=$(e).closest(".nav__group");t.addClass("opened initial"),setTimeout(function(){t.removeClass("initial")},500)})}),$(document).ready(function(){$("textarea").autosize()}),$(window).on("turbolinks:load",function(){$("textarea").autosize(),$(".with-nested-sortable > ul").withNestedSortable(),$(".nested-list .add_fields").data("association-insertion-method","append").data("association-insertion-node",function(t){return t.parents(".nested-list").find(".nested-node")}),$(".sidebar .optiscroll").optiscroll({preventParentScroll:!0,forceScrollbars:!0}),t?$("body").addClass("mobile"):$("body").addClass("desktop"),n?$("body").addClass("touch"):$("body").addClass("notouch")})});var _railsUjs=_interopRequireDefault(require("rails-ujs"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}_railsUjs.default.start(),$(function(){$(".with-nested-sortable > ul").withNestedSortable(),$("a.ajax-post").ajaxRequestLink(),$("a.ajax-delete").ajaxRequestLink({method:"delete"}),$("form.method-link-to").addLinkToSubmitForm(),$(".with-togglable-navigation .active a").tab("show"),$(".with-togglable-navigation a").click(function(t){t.preventDefault(),$(this).tab("show")}),$(".with-togglable-navigation *[data-toggle]").on("shown",function(t){$(t.target).addClass("active")}),$(".with-move-to").sortable({handle:".icon-move",stop:function(t,e){var n=e.item.prev().data("id"),a=e.item.data("href");$.post(a,{to:n})}}),$(".with-apply-sortable-order[data-sortable]").sortable({opacity:.6,helper:function(t,e){var n="",a=$(e).find(".sortable-helper");return n=0<a.length?'<img src="'.concat($(a).attr("src"),'"/>'):$(e).attr("data-placeholder"),'<div class="helper" style="width: auto; height: auto">'.concat(n,"</div>")},appendTo:"body",handler:"icon-move",items:$(this).attr("items"),stop:function(){var t=$(this).attr("data-sortable");if(t){var e=$.map($(this).children(),function(t){return $(t).attr("data-id")});$.ajax({type:"post",dataType:"script",data:{id:e},url:t})}}})});var _spin=_interopRequireDefault(require("spin/dist/spin.min"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}spinnerOpts={lines:11,length:5,width:2,radius:5,corners:1,rotate:0,color:"#fff",speed:1,trail:50,shadow:!1,hwaccel:!1,className:"spinner",zIndex:1e3,top:"auto",left:"auto"};$(function(){$.fn.spin=function(){return this.each(function(){var t=$(this),e=t.data();e.spinner&&(e.spinner.stop(),delete e.spinner),!1!==spinnerOpts&&(e.spinner=new _spin.default($.extend({color:t.css("color")},spinnerOpts)).spin(this))}),this}}),$.fn.withNestedSortable=function(t){var e=$.extend({},$.fn.withNestedSortable.defaults,{maxLevels:$(this).attr("max-levels")}),n=$.extend({},e,t);$(this).nestedSortable({listType:"ul",opacity:.8,items:"li",tabSize:32,maxLevels:n.maxLevels,disableNesting:"no-nesting",forcePlaceholderSize:!0,placeholder:"placeholder",tolerance:"pointer",toleranceElement:"> div",handle:".-move",start:function(t,e){$(e.helper).addClass("dragging")},stop:function(t,e){var n=e.item;n.removeClass("dragging");n.attr("rel");var a=n.parents("li").attr("rel"),i=n.prev("li").first().attr("rel");null==a&&(a=void 0),null==i&&(i=void 0);var o={_method:"PUT",prevId:i,parentId:a};$.ajax({async:!1,type:"POST",url:n.attr("href"),dataType:"script",data:o})}})},$.fn.withNestedSortable.defaults={maxLevels:0},$.fn.ajaxRequestLink=function(t){var a=$.extend({},{type:"POST",method:"post",confirmation:"Вы уверены?"},t);$(this).on("click",function(t){t.preventDefault();var e=$(this),n=$("meta[name=csrf-token]").attr("content");return"string"!=typeof n||$.ajax({type:a.type,url:e.attr("rel"),data:{authenticity_token:n,_method:a.method},beforeSend:function(t){if(e.is(".with-confirmation")&&!0!==window.confirm(a.confirmation))return!1},success:function(t){e.is(".disable-after-success")&&e.replaceWith($("<span>".concat(e.text(),"</span>")))}}),!1})},$.fn.addLinkToSubmitForm=function(){0<$(this).length&&$(this).each(function(){var t=$(this);if(0===t.find("a.submit-form").length){var e=$('<a class="submit-form" href="'.concat(t.attr("action"),'">').concat(t.attr("title"),"</a>"));t.append(e),t.attr("title","")}})};